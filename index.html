<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Painel de Metas - Estático</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- PapaParse para CSV -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
  :root{
    --bg:#061b1a;
    --card:#073233;
    --accent:#f8f8f8;
    --text:#dff9f0;

  }
  body{
    margin:0;
    font-family: Inter, system-ui, sans-serif;
    background: linear-gradient(180deg,#041716 0%,#072a29 100%);
    color:var(--text);
  }

  .container {
    display: grid;
    grid-template-columns: 300px 1.5fr 90px;
    grid-template-areas: "left center right";
    gap: 18px;
    padding: 10px;
    max-width: 1250px;
    margin: 18px auto;
  }

  /* Left: gauges list */
  .left{
    grid-area: left; 
    background:var(--card);
    border-radius:12px;
    padding:10px;
    box-shadow:0 6px 18px rgba(0,0,0,0.35);
  }
  .gauge-item{
    margin-bottom:18px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
    padding:8px;
    border-radius:10px;
  }
  .gauge-title{font-weight:700; font-size:18px; margin-bottom:6px; color:#9ef5b9}
  canvas.gauge{ width:180% !important; height:55px !important; display:block; transform: translateX(-20%); /* centraliza novamente */}


  /* Center: mapa */
  .center{
    grid-area: center;
    background:var(--card);
    border-radius:12px;
    padding:18px;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
  }

  .map-overlay-text{
    position:absolute;
    left:12%;
    top:54%;
    transform:translateY(-50%);
    color:rgba(255,255,255,0.95);
    font-size:48px;
    font-weight:800;
    pointer-events:none;
    mix-blend-mode:screen;
  }
  .meta-row{
    width:100%;
    display:flex;
    justify-content:space-between;
    margin-top:12px;
    font-size:14px;
  }

  /* Right: barra vertical (termômetro) */
  .right {
    grid-area: right; 
    color: #eff1f1;
    transition: background 1s ease;
    border-radius: 12px;
    padding: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255,255,255,0.03);
    box-shadow: inset 0 0 15px rgba(0,0,0,0.3);
  }

  .thermo{
    width:28px;
    height:80%;
    background:rgba(255,255,255,0.06);
    border-radius:20px;
    padding:6px;
    box-sizing:border-box;
    display:flex;
    align-items:flex-end;
  }
    .thermo-fill {
    transition: height 700ms ease, background-color 700ms ease;
  }

  /* Footer small help */
  .hint{ font-size:12px; color:rgba(255,255,255,0.6); margin-top:8px }

  @media (max-width:980px){
  .container {
    grid-template-columns: 1fr;
    grid-template-areas:
      "center"
      "right"
      "left";
    padding: 5px;
  }

  .right {
    order: 3; /* opcional, pode remover se quiser seguir a área definida */
  }

  .meta-row {
    font-size:13px;
  }
}

</style>
</head>
<body>

<div class="container">
  <!-- Coluna Esquerda -->
  <div class="left" id="left-col">
    <h2 style="margin:0 0 8px 0;color:var(--accent)">Arrecadação por classes<br></h2>
    <div id="gauges"></div>
    <div class="hint">Dados atualizados semanalmente</div>
  </div>

  <!-- Coluna Central -->
  <div class="center">
    <h1 style="margin:0 0 12px 0;color:var(--accent)">Missões Nacionais - PIB Propriá</h1>
    <div class="map-wrap">
      <img id="brazil-map-img" src="mapa-brasil.png" alt="Mapa do Brasil" 
           style="width:90%;height:100%;object-fit:contain;filter:brightness(0.7) saturate(1.2);border-radius:12px;">
    </div>

    <div class="meta-row">
      <div><h2>Meta Igreja: <strong id="church-target">R$ 0</strong></h2></div>
      <div><h2>Arrecadado: <strong id="church-achieved">R$ 0</strong></h2></div>
    </div>
  </div>

  <!-- Coluna Direita -->
  <div class="right"> 
    <h2>
      <div style="text-align:center">
      <div style="margin-bottom:12px">P<br>r<br>o<br>g<br>r<br>e<br>s<br>s<br>o</div>
      <div class="thermo">
        <div class="thermo-fill" id="thermoFill" style="height:8%"></div>
      </div>
      <div style="margin-top:12px;text-align:center" id="thermo-label">0%</div>
    </div>
  </h2>
  </div>
</div>

<script>
/* CONFIGURAÇÃO */
const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSiU5NVcMA3uRg-k2LOLMAW5JKdXrJ33BmgZA2YbQD3M33QoSZoVoneBfuo-M8vO2WfvXWV-EdlPvmX/pub?gid=0&single=true&output=csv";
const gaugeColors = ['#ff3b30','#ff9a00','#ffd600','#7ee07a','#00b0ff'];
function fmtMoney(v){ return 'R$ ' + Number(v).toLocaleString('pt-BR',{minimumFractionDigits:0}); }
function clamp(v, a=0, b=100){ return Math.max(a, Math.min(b, v)); }

/* === PRINCIPAL === */
async function loadAndRender(){
  if(!SHEET_CSV_URL || SHEET_CSV_URL.includes("COLE_AQUI")) {
    document.getElementById('gauges').innerHTML = '<div style="color:#ff9b9b">Cole a URL CSV da planilha em SHEET_CSV_URL no código.</div>';
    return;
  }
  try {
    const res = await fetch(SHEET_CSV_URL);
    if(!res.ok) throw new Error('Não foi possível buscar a planilha (verifique a URL e permissões).');
    const csvText = await res.text();
    const parsed = Papa.parse(csvText, {header:true, skipEmptyLines:true});
    const rows = parsed.data;
    const classes = rows.filter(r => (r.type || '').trim().toLowerCase() === 'class' || (r.type || '').trim().toLowerCase() === 'classe');
    const totalTarget = classes.reduce((sum, r) => sum + (Number(r.target) || 0), 0);
    const totalAchieved = classes.reduce((sum, r) => sum + (Number(r.achieved) || 0), 0);
    renderGauges(classes);
    renderChurch({target: totalTarget, achieved: totalAchieved});
  } catch(err) {
    console.error(err);
    document.getElementById('gauges').innerHTML = '<div style="color:#ff9b9b">Erro: ' + err.message + '</div>';
  }
}

/* GAUGES (mantido como estava) */
function renderGauges(items){
  const container = document.getElementById('gauges');
  container.innerHTML = '';
  if(!items || items.length===0){
    container.innerHTML = '<div style="color:#cfe6ce">Nenhuma classe encontrada na planilha.</div>';
    return;
  }
  items.forEach((it, idx) => {
    const name = it.name || `Classe ${idx+1}`;
    const target = Number(it.target) || 0;
    const achieved = Number(it.achieved) || 0;
    const percent = target>0 ? Math.round((achieved/target)*100) : 0;
    const percentClamped = clamp(percent,0,100);
    const wrapper = document.createElement('div');
    wrapper.className = 'gauge-item';
    wrapper.innerHTML = `
      <div class="gauge-title">${name} — ${fmtMoney(achieved)} / ${fmtMoney(target)} (<span id="pct-${idx}">${percentClamped}%</span>)</div>
      <canvas class="gauge" id="gauge-${idx}"></canvas>
    `;
    container.appendChild(wrapper);
    const ctx = wrapper.querySelector('canvas').getContext('2d');
    const achievedValue = Math.max(0, Math.min(target, achieved));
    const restValue = Math.max(0, target - achievedValue);
    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['atingido','restante'],
        datasets:[{
          data: [achievedValue, restValue],
          backgroundColor: [pickGaugeColor(percentClamped),'rgba(255,255,255,0.06)'],
          borderWidth:0,
          hoverOffset:0
        }]
      },
      options: {
        rotation: Math.PI,
        circumference: Math.PI,
        cutout: '70%',
        responsive:true,
        maintainAspectRatio:false,
        plugins:{ legend:{display:false}, tooltip:{enabled:false} }
      }
    });
  });
}
function pickGaugeColor(p){
  if(p<=25) return gaugeColors[0];
  if(p<=50) return gaugeColors[1];
  if(p<=75) return gaugeColors[2];
  if(p<=99) return gaugeColors[3];
  return gaugeColors[4];
}

/* Painel da igreja (mapa + barra) */
function renderChurch(row){
  const target = row ? Number(row.target)||0 : 0;
  const achieved = row ? Number(row.achieved)||0 : 0;
  const percent = target>0 ? Math.round((achieved/target)*100) : 0;
  const percentClamped = clamp(percent,0,100);
  document.getElementById('church-target').textContent = fmtMoney(target);
  document.getElementById('church-achieved').textContent = fmtMoney(achieved);
  document.getElementById('thermo-label').textContent = percentClamped + '%';
  const thermo = document.getElementById('thermoFill');
  thermo.style.height = (percentClamped) + '%';
  // Chama para mudar a cor da coluna direita
  aplicarCorTermometro(percentClamped);

}

/* === Função robusta: aplica cor somente para a Coluna Direita === */
// === GRADIENTE SUAVE: cor começa clara e fica mais forte conforme sobe ===
function aplicarCorTermometro(percentual) {
  const colunaDireita = document.querySelector('.right');
  if (!colunaDireita) return;

  // Define a cor base de acordo com o progresso
  let corBase = '#e53935'; // vermelho padrão
  if (percentual > 75) corBase = '#4caf50'; // verde
  else if (percentual > 50) corBase = '#ffeb3b'; // amarelo
  else if (percentual > 25) corBase = '#ff9800'; // laranja

  // Normaliza o percentual (0–100)
  const preenchimento = Math.min(Math.max(percentual, 0), 100);

  // Cria um gradiente que começa suave e intensifica a cor
  colunaDireita.style.background = `
    linear-gradient(
      to top,
      ${corBase} ${preenchimento}%,
      rgba(255,255,255,0.05) ${preenchimento + 10}%,
      rgba(255,255,255,0.15) ${preenchimento + 25}%,
      rgba(255,255,255,0.25) 100%
    )
  `;

  // Suaviza a transição
  colunaDireita.style.transition = 'background 1s ease';
}




/* Inicializa */
loadAndRender();
</script>


</body>
</html>


